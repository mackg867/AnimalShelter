<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Animalshelter by mackg867</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Animal Shelter Analysis</h1>
      <a href="https://github.com/mackg867/AnimalShelter" class="btn">View on GitHub</a>
      <a href="https://github.com/mackg867/AnimalShelter/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/mackg867/AnimalShelter/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>

    <h3><b>Background</b></h3>
    
<p>This webpage documents my work with regards to the Shelter Animal Outcomes Kaggle competition.  My main motivitaion for this project 
was to learn to use Tableau, the dplyr package, and version control to do data analysis.  In past projects my data analysis workflow 
had been a bunch of cowboy code in one huge script.  This setup was a nightmare to maintain and after a certain point it was 
impossible to change an assumption I had made in the beginning of the workflow.  For this project I strove to make sure my code was 
modular and clean.</p>

<p>The following is the introduction to the competition provided by Kaggle.</p>

<div style="font-family:chicago;margin-left:1em;">Every year, approximately 7.6 million companion animals end up in US shelters. 
Many animals are given up as unwanted by their owners, while others are picked up after getting lost or taken out of cruelty situations. 
Many of these animals find forever families to take them home, but just as many are not so lucky. 2.7 million dogs and cats are euthanized in the US every year.
Using a dataset of intake information including breed, color, sex, and age from the Austin Animal Center, we're asking Kagglers to predict the outcome for each animal.  
We also believe this dataset can help us understand trends in animal outcomes. These insights could help shelters focus their energy on specific animals who need a little extra help finding a new home.
</div>

<p>The data provided for the competition was split between a training set and a test set.  The training set identifies the outcome for each
animal while the test set does not.  Competitors are tasked with building a predictive model with the training set and then applying the model
to the test set.  Kaggle scores the performance of the model and then posts the score on the leaderboard with the other competitors
submissions.</p>

    <h3><b>Data Munging</b></h3>
    
<p>Number of Training Observations: 26,729</p>
<p>Number of Test Observations: 11,456</p>

<h5>Independant Variable Definitions</h5>
<p><b>Name</b> - Lists the name of the animal.</p>
<p><b>DateTime</b> - No information is provided as to what the date/time signifies but for my analysis I assumed it was the date/time
of the outcome.  Going off this assumption I did not include this variable in my model because we don't have any knowledge of when
an outcome will happen before it happens.</p>
<p><b>AnimalType</b> - Lists whether the animal is a cat or dog.</p>
<p><b>SexuponOutcome</b> - Describes whether the animal is male/female and if it has been neutured/spayed.  An argument can be made 
that the neutured/spayed information should not be used in the model since this information was documented when the outcome occurs.  We don't know when 
the animal had been fixed and how that affected the outcome.  That being said I chose to include 
the information in my analysis to see if there were any interesting patterns regarding this information.</p>
<p><b>AgeuponOutcome</b> - Age of the animal when the outcome event happened.  The same argument can be made with AgeuponOutcome as 
the spayed/neutured information.  I assumed that the change in age of the animal while in the shelter was negligable and therefore 
included this variable.</p>
<p><b>Breed</b> - Lists the breed of the animal.</p>
<p><b>Color</b> - Lists the color of the animal.</p>

<h5>Dependant Variable Definitions</h5>
<p><b>OutcomeType</b> - Describes what happened to the animal.  
Five possible values: Return to Owner, Euthanasia, Died, Transfer, Adoption.</p>
<p><b>OutcomeSubtype</b> - Gives further information about the type of outcome that occured.  
The competition only specified to predict type of outcome and not the subtype.  For simplicity I chose to 
drop this variable.</p>

<h5>Variable Transformations</h5>
<p>The code that performs the following transformations can be found in the Clean.R file.</p>

<p><b>Name</b> - Instead of using the acutal name of the animal I changed the variable to indicate whether the animal had a
name or not.</p>
<p><b>SexuponOutcome</b> - I pulled out the spayed/neutered information into its 
own variable called IsFixed, where a value of Yes denotes that the animal has been spayed/neutered while No denotes the animal 
has been left intact.  I also pulled out the male/female information into its own variable called Sex that has the values of Male 
and Female.  There was only one NA value within the SexuponOutcome variable.  I included this observation with the other unknown obeservations.</p>
<p><b>AgeuponOutcome</b> - The AgeuponOutcome was originally given in terms of days, weeks, months, and years.  I modified the variable to be measured
in days and changed the name to be Age.  Any animals that did not have an age were given an age of zero, within the training data 
set there were 18 animals with no age.  Note, there were also 22 animals with an age of 0 years.</p>
<p><b>Breed</b> - In total there were 1,380 unique breeds listed in the data set.  To reduce the number of breeds to a more 
managable size I made two new variables.  The first is called MixBreed which describes whether the animal is a mix of two or more breeds. 
The other variable is called MainBreed which was created by taking the first breed listed in the mix.  For example, 
"Cardigan Welsh Corgi/Australian Cattle Dog" would be turned into "Cardigan Welsh Corgi".  The transformation resulted in 68 unique breeds.</p>
<p><b>Color</b> - This was another variable that contained a lot of unique types.  There were 366 different types of colors listed 
in the data set.  To reduce this number down I used the same method as I did for Breed.  I created a new variable that described
whether the color was mixed called MixColor.  I also created a variable called MainColor that was created in the same way as 
MainBreed.  The transformation resulted in 26 unique colors</p>

    <h3><b>Exploratory Data Analysis</b></h3>

<p>The following graphic was made using Tableau Public.  You are encourage to explore the different plots to see what patterns you can 
discover.  Notice that even though I did not inlcude the date/time variable in the predictive model I included 
it in some of the plots.  Viewing date/time in this way allows you to see any historical trends in the data.  You can see that there is a seasonal trend in outcomes.  
There are many more outcomes during the summer months than the winter months.  If you further breakdown the data you will notice that 
this trend is solely due to the outcomes from cats.</p>

<p>Some other interesting things to note.  Dogs are more likely to be returned to their owner while cats are more likely to die.  
The most likely outcome for a cat is to be transfered while dogs are most likely to be adopted.  An observation that will 
shock no one, people tend to adopt younger animals, especailly kittens.</p>
<br><br>

<script type='text/javascript' src='https://public.tableau.com/javascripts/api/viz_v1.js'></script><div class='tableauPlaceholder' style='width: 1004px; height: 869px;'><noscript><a href=''><img alt='Animal Shelter Data ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;CB&#47;CB644NFHZ&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz' width='1004' height='869' style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='path' value='shared&#47;CB644NFHZ' /> <param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;CB&#47;CB644NFHZ&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='showTabs' value='y' /></object></div>

    <h3><b>Modeling Procedure and Results</b></h3>
<p>For this problem I built 5 different predictive models.  They are listed below along with their overall accuracy on the hold out sample.</p>
<p>Naive Bayes - 0.6034</p>
<p>Multinomial Logistic - 0.622</p>
<p>Random Forest - 0.631</p>
<p>Neural Net (2 Layers of 20 nodes each) - 0.6325</p>
<p>Gradient Boosting Machine (GBM) - 0.635</p>

<p>Since the GBM performed the best on the hold out sample I used it as my submission to the Kaggle competition.  It gives a 58% 
increase in accuracy over just guessing the most common outcome.  Two months before the competition closes my submission placed in the 50th percentile.  
To gain insight into the behavior of the GBM model I created the following table that displays the true positive rate and the true negative 
rate for each outcome.  Notice that the model has trouble identifying the outcomes of Died and Euthanasia which isn't too surprising since those 
outcomes have the lowest occurances in the data set.</p>
<table style="width:100%">
   <tr>
    <td> </td>
     <td>Adoption</td> 
     <td>Died</td>
     <td>Euthanasia</td>
     <td>Return to Owner</td>
     <td>Transfer</td>
   </tr>
  <tr>
    <td>True Positve Rate</td>
     <td>0.87</td> 
     <td>0</td>
     <td>0.04</td>
     <td>0.35</td>
     <td>0.65</td>
   </tr>
   <tr>
    <td>True Negative Rate</td>
     <td>0.66</td> 
     <td>1.0</td>
     <td>1.0</td>
     <td>0.91</td>
     <td>0.87</td>
   </tr>
</table> 

<p>Although the GBM provides the best predictive performance on the out of sample data it doesn't offer much in terms of 
interprebality.  To gain a better understanding between the independant variables and the outcomes you can use the 
coefficients of the logistic model.  For the sake of brevity I dropped the variables relating to color and breed.  
If I was doing a complete analysis I would include this information.  Below is a table of the coefficients of the model.</p>
<br>
<table style="width:100%">
   <tr>
    <td> </td>
     <td>Intercept</td>
     <td>Name Yes</td>
     <td>AnimalType Dog</td>
     <td>Age</td>
     <td>Sex Male</td>
     <td>Sex Unknown</td>
     <td>IsFixed Unknown</td>
     <td>IsFixed Yes</td>
   </tr>
  <tr>
    <td>Died</td>
     <td>-0.71</td> 
     <td>-0.88</td>
     <td>-0.67</td>
     <td>0.00</td>
     <td>0.52</td>
     <td>6.2</td>
     <td>6.2</td>
     <td>-4.3</td>
   </tr>
   <tr>
    <td>Euthanasia</td>
     <td>0.58</td> 
     <td>-1.1</td>
     <td>0.23</td>
     <td>0.00</td>
     <td>0.43</td>
     <td>6.1</td>
     <td>6.1</td>
     <td>-3.9</td>
   </tr>
   <tr>
     <td>Return to Owner</td>
     <td>-2.1</td> 
     <td>1.7</td>
     <td>1.5</td>
     <td>0.00</td>
     <td>0.28</td>
     <td>6.1</td>
     <td>6.1</td>
     <td>-2.5</td>
   </tr>
   <tr>
     <td>Transfer</td>
     <td>2.7</td> 
     <td>-0.7</td>
     <td>-0.15</td>
     <td>0.00</td>
     <td>0.15</td>
     <td>6.2</td>
     <td>6.2</td>
     <td>-3.5</td>
   </tr>
</table> 
<br>
<p>Notice that there are only 4 outcomes displayed in the table.  The reason for this is that the fifth outcome (Adoption) is used as a 
baseline for the other outcomes.  The coefficients of the model describe how the probability of the
specified outcome changes as it relates to the outcome of Adoption when the independant variable is altered.  For example, the coefficient for the AnimalType-Dog indicator variable 
is -.67 for the outcome of Died.  Since the coefficient is negative this means that the probablity of dying decreases if the animal is 
a dog.  Conversely, if a coefficient is positive then the probability of that outcome occuring increases relative to Adoption 
when the independant variable is true (or increases in the case of a numerical variable).  You can perform 
some simple algebra on the coefficients to determine the acutal change in probablity when the independant variable changes, but sometimes it's enough to 
know how the probability will change.  Another way to determine how the independant variables affect a specific outcome is to transform the 
dependant variable into a binary outcome. I did this for the outcome of Euthanasia. After the transformation the OutcomeType variable is made 
of just two outcomes, either Euthanasia or NotEuthanasia. The resulting model coefficients are as follows.</p>
<br>
<table>
   <tr>
     <td> </td>
     <td>Intercept</td>  
     <td>Name Yes</td>
     <td>AnimalType Dog</td>
     <td>Age</td>
     <td>Sex Male</td>
     <td>Sex Unknown</td>
     <td>IsFixed Unknown</td>
     <td>IsFixed Yes</td>
   </tr>
   <tr>
     <td>Euthanasia</td>
     <td>-2.2</td>  
     <td>-0.84</td>
     <td>0.18</td> 
     <td>0.00</td> 
     <td>0.24</td>  
     <td>-0.13</td>
     <td>-0.13</td>
     <td>-1.5</td>
   </tr>
</table>
<br>
<p>Another way to determine variable importance is to use the random forest model.  R tracks the predicitve performance of independant variables 
during the model building process.  Once finished, it gives you a plot that shows which variables were most important for prediction. 
The plot below shows which of the variables used in the animal shleter data is most important.  The larger the MeanDecreaseGini the 
better the variable is for prediction.  Notice that Age is listed as the second most useful variable but the coefficient 
for Age in the multinomial model was esstientailly 0, which suggests that the variable is not important.  Remember that Age was 
measured in days and therefore the coefficient is related to the change in probability <b>per day</b>.  For interpretation reasons 
it would probably be more useful to measure Age in years so that the coefficient becomes more meaningful. </p>

<img src="VarImp.jpeg" width="894" height="547">

<h5>Conditonal Relationships versus Causul Relationships</h5>
<p>A quick note on conditional relationships versus causul relationships.  From the summaries of the models you can see that if  
an animal is fixed then their chances of being adopted increase.  Since this fact is coming from the models it represents a 
conditional relationship.  Said another way, the probability of adoption <b>given</b> the animal has been fixed is higher then the probability 
of being adopted in general.  But this does not necessarily mean there is a causul relationship between getting fixed and being adopted.  
A superficial analysis would lead you to believe that in order to increase adoptions you should fix animals beforehand.  
It does seem very reasonable that if an animal has already been fixed that people are more likely to adopt them since this reduces the 
cost of ownership.  Although, I can imagine a scenario where midway through the data collection process the animal shelter required 
that before someone adopts an animal the animal must be fixed first.  A situation such as this would show a relationship between getting fixed and 
being adopted but you couldn't necessarily say that fixing an animal increases their chances of being adopted.  
Further analysis on how the data was collected and how the animal shelter is run is needed before any conclusive casual relationships can be stated.</p>


      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/mackg867/AnimalShelter">Animalshelter</a> is maintained by <a href="https://github.com/mackg867">mackg867</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>
  
  
  </body>
</html>
